<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BloxOLite Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1117;
      --card-bg: #111827;
      --border: #1f2937;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --text: #fff;
      --muted: #9ca3af;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: "Inter", sans-serif;
      scroll-behavior: smooth;
      overflow-x: hidden;
    }

    nav {
      background: rgba(17, 24, 39, 0.95);
      backdrop-filter: blur(10px);
      padding: 18px 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      font-weight: 700;
      font-size: 24px;
      color: var(--accent);
    }

    .links a {
      color: var(--muted);
      margin-left: 25px;
      text-decoration: none;
      font-size: 15px;
      transition: 0.2s ease;
    }

    .links a:hover { color: var(--text); }

    .container {
      max-width: 1000px;
      margin: 50px auto;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 40px;
      border: 1px solid var(--border);
      box-shadow: 0 0 25px rgba(99, 102, 241, 0.1);
    }

    h1 {
      text-align: center;
      color: var(--accent);
      margin-bottom: 30px;
    }

    .logout-btn {
      float: right;
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    .logout-btn:hover { background: var(--accent-light); }

    .section {
      margin-top: 40px;
    }

    .section h2 {
      margin-bottom: 20px;
      color: var(--accent-light);
    }

    .log-list, .announcement-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .log, .announcement {
      background: var(--bg);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .log:hover, .announcement:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      transition: 0.2s ease;
    }

    input, textarea {
      width: 100%;
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 10px;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover { background: var(--accent-light); }

    .hidden { display: none; }

    #login-section {
      max-width: 400px;
      margin: 100px auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 16px;
      border: 1px solid var(--border);
      text-align: center;
      box-shadow: 0 0 20px rgba(99,102,241,0.15);
    }

    #login-section input {
      margin-bottom: 15px;
    }

    #login-section button {
      width: 100%;
    }

  </style>
</head>
<body>
  <nav>
    <div class="logo">BloxOLite Dashboard</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="docs.html">Docs</a>
      <a href="https://discord.gg/tcxqKNR649" target="_blank">Discord</a>
    </div>
  </nav>

  <section id="login-section">
    <h1>Access Code Required</h1>
    <input type="password" id="accessCode" placeholder="Enter Access Code">
    <button id="loginButton">Enter</button>
    <p id="errorMsg" style="color:red;display:none;margin-top:10px;">Invalid Access Code.</p>
  </section>

  <div id="dashboard" class="container hidden">
    <button class="logout-btn" id="logoutButton">Sign Out</button>
    <h1>ðŸ‘‹ Welcome to Your Dashboard</h1>

    <div class="section">
      <h2>ðŸ“œ Recent Logs</h2>
      <div id="log-list" class="log-list">
        <p style="color:var(--muted)">Loading logs...</p>
      </div>
    </div>

    <div class="section">
      <h2>ðŸ“¢ Announcements</h2>
      <input id="announce-title" placeholder="Title">
      <textarea id="announce-message" rows="3" placeholder="Message (supports <b>, <i>, <u>, <img>)"></textarea>
      <button id="postAnnouncement">Post Announcement</button>
      <div id="announcement-list" class="announcement-list" style="margin-top:20px;"></div>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBZJa5yjFeCmAPOQOHUKCZpq_yEyCJtdPI",
      authDomain: "bloxolite.firebaseapp.com",
      projectId: "bloxolite",
      storageBucket: "bloxolite.firebasestorage.app",
      messagingSenderId: "261033706903",
      appId: "1:261033706903:web:241f50fbaf65209dfa30d2",
      databaseURL: "https://bloxolite-default-rtdb.europe-west1.firebasedatabase.app/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const rtdb = getDatabase(app);

    const loginSection = document.getElementById("login-section");
    const dashboard = document.getElementById("dashboard");
    const loginButton = document.getElementById("loginButton");
    const logoutButton = document.getElementById("logoutButton");
    const errorMsg = document.getElementById("errorMsg");
    const logList = document.getElementById("log-list");
    const postBtn = document.getElementById("postAnnouncement");
    const announceTitle = document.getElementById("announce-title");
    const announceMessage = document.getElementById("announce-message");
    const announcementList = document.getElementById("announcement-list");

    // âœ… Hash function (same as your old one)
    function hashString(str) {
      return Array.from(str).reduce((h, c) => {
        h = (h << 5) - h + c.charCodeAt(0);
        return h & h;
      }, 0).toString();
    }

    const ACCESS_HASH = "-94374278"; // ðŸ‘ˆ your hash for "Ciderg1010"

    loginButton.addEventListener("click", () => {
      const code = document.getElementById("accessCode").value;
      const hash = hashString(code);

      if (hash === ACCESS_HASH) {
        loginSection.classList.add("hidden");
        dashboard.classList.remove("hidden");
        loadLogs();
        loadAnnouncements();
      } else {
        errorMsg.style.display = "block";
      }
    });

    logoutButton.addEventListener("click", () => {
      dashboard.classList.add("hidden");
      loginSection.classList.remove("hidden");
      document.getElementById("accessCode").value = "";
    });

    function loadLogs() {
      const logsRef = ref(rtdb, "logs");
      onValue(logsRef, (snapshot) => {
        logList.innerHTML = "";
        if (!snapshot.exists()) {
          logList.innerHTML = "<p style='color:#9ca3af'>No logs yet.</p>";
          return;
        }
        const logs = Object.values(snapshot.val()).reverse();
        logs.forEach(log => {
          const div = document.createElement("div");
          div.className = "log";
          div.innerHTML = `
            <strong>${log.player || "Unknown Player"}</strong> â€” ${log.reason || "No reason"}
            <br><small style="color:#6b7280">${new Date(log.time || Date.now()).toLocaleString()}</small>
          `;
          logList.appendChild(div);
        });
      });
    }

    async function loadAnnouncements() {
      const q = query(collection(db, "announcements"), orderBy("createdAt", "desc"), limit(5));
      const snap = await getDocs(q);
      announcementList.innerHTML = "";
      snap.forEach(doc => {
        const data = doc.data();
        const card = document.createElement("div");
        card.className = "announcement";
        card.innerHTML = `
          <h4>${data.title || "Untitled"}</h4>
          <p>${data.message}</p>
          ${data.image ? `<img src="${data.image}" style="max-width:100%;border-radius:8px;margin-top:10px;">` : ""}
          <small style="color:#6b7280">${data.date || "Unknown Date"}</small>
        `;
        announcementList.appendChild(card);
      });
    }

    postBtn.addEventListener("click", async () => {
      const title = announceTitle.value.trim();
      const message = announceMessage.value.trim();
      if (!title || !message) return alert("Please fill in all fields.");
      await addDoc(collection(db, "announcements"), {
        title,
        message,
        createdAt: serverTimestamp(),
        date: new Date().toLocaleString()
      });
      announceTitle.value = "";
      announceMessage.value = "";
      loadAnnouncements();
    });
  </script>
</body>
</html>
